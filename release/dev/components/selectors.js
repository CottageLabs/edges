$.extend(edges,{newRefiningANDTermSelector:function(e){return e||(e={}),edges.RefiningANDTermSelector.prototype=edges.newSelector(e),new edges.RefiningANDTermSelector(e)},RefiningANDTermSelector:function(e){this.size=e.size||10,this.orderBy=e.orderBy||"count",this.orderDir=e.orderDir||"desc",this.deactivateThreshold=e.deactivateThreshold||!1,this.ignoreEmptyString=e.ignoreEmptyString||!0,this.excludePreDefinedFilters=e.excludePreDefinedFilters||!0,this.valueMap=e.valueMap||!1,this.valueFunction=e.valueFunction||!1,this.inflation=e.inflation||100,this.defaultRenderer=e.defaultRenderer||"newRefiningANDTermSelectorRenderer",this.filters=[],this.values=[],this.contrib=function(e){var t={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir};this.size&&(t.size=this.size),e.addAggregation(es.newTermsAggregation(t))},this.synchronise=function(){if(this.values=[],this.filters=[],this.edge.result){var e=this.edge.result.buckets(this.id);e.length<this.deactivateThreshold?this.active=!1:this.active=!0;var t=[];this.excludePreDefinedFilters&&(t=this.edge.baseQuery.listMust(es.TermFilter({field:this.field})));for(var i=0,s=0;s<e.length;s++){var r=e[s];if(!this.ignoreEmptyString||""!==r.key){if(this.excludePreDefinedFilters){for(var n=!1,o=0;o<t.length;o++){var h=t[o];if(r.key===h.value){n=!0;break}}if(n)continue}if(i++,i>this.size)break;var l=this._translate(r.key),a={display:l,term:r.key,count:r.doc_count};this.values.push(a)}}}for(var u=this.edge.currentQuery.listMust(es.newTermFilter({field:this.field})),s=0;s<u.length;s++){var d=u[s].value;d=this._translate(d),this.filters.push({display:d,term:u[s].value})}},this.selectTerm=function(e){var t=this.edge.cloneQuery();t.addMust(es.newTermFilter({field:this.field,value:e})),t.from=0,this.edge.pushQuery(t),this.edge.doQuery()},this.removeFilter=function(e){var t=this.edge.cloneQuery();t.removeMust(es.newTermFilter({field:this.field,value:e})),t.from=0,this.edge.pushQuery(t),this.edge.doQuery()},this.changeSize=function(e){this.size=e;var t=this.edge.cloneQuery(),i=t.getAggregation({name:this.id});i.size=this.size,this.edge.pushQuery(t),this.edge.doQuery()},this.changeSort=function(e,t){this.orderBy=e,this.orderDir=t;var i=this.edge.cloneQuery(),s=i.getAggregation({name:this.id});s.setOrdering(this.orderBy,this.orderDir),this.edge.pushQuery(i),this.edge.doQuery()},this._translate=function(e){if(this.valueMap){if(e in this.valueMap)return this.valueMap[e]}else if(this.valueFunction)return this.valueFunction(e);return e}},newORTermSelector:function(e){return e||(e={}),edges.ORTermSelector.prototype=edges.newSelector(e),new edges.ORTermSelector(e)},ORTermSelector:function(e){this.lifecycle=e.lifecycle||"static",this.orderBy=e.orderBy||"term",this.orderDir=e.orderDir||"asc",this.size=e.size||10,this.valueMap=e.valueMap||!1,this.valueFunction=e.valueFunction||!1,this.defaultRenderer=e.defaultRenderer||"newORTermSelectorRenderer",this.terms=e.terms||!1,this.selected=[],this.updating=!1,this.init=function(e){edges.newSelector().init.call(this,e),this.terms||this.listAll()},this.synchronise=function(){this.selected=[];for(var e=this.edge.currentQuery.listMust(es.newTermsFilter({field:this.field})),t=0;t<e.length;t++)for(var i=0;i<e[t].values.length;i++){var s=e[t].values[i];this.selected.push(s)}},this.listAll=function(){var e=this.edge.cloneBaseQuery();e.clearAggregations(),e.size=0;var t={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir,size:this.size};e.addAggregation(es.newTermsAggregation(t)),es.doQuery({search_url:this.edge.search_url,queryobj:e.objectify(),datatype:this.edge.datatype,success:edges.objClosure(this,"listAllQuerySuccess",["result"]),error:edges.objClosure(this,"listAllQueryFail")})},this.listAllQuerySuccess=function(e){var t=e.result;this.terms=[];for(var i=t.buckets(this.id),s=0;s<i.length;s++){var r=i[s];this.terms.push({term:r.key,display:this._translate(r.key),count:r.doc_count})}this.setupEvent(),this.draw()},this.listAllQueryFail=function(){this.terms=[]},this.setupEvent=function(){"update"===this.lifecycle&&(this.edge.context.on("edges:pre-query",edges.eventClosure(this,"doUpdate")),this.doUpdate())},this.doUpdate=function(){if(!this.updating){this.udpating=!0;var e=this.edge.cloneQuery();e.removeMust(es.newTermsFilter({field:this.field})),e.clearAggregations(),e.size=0;var t={name:this.id,field:this.field,orderBy:this.orderBy,orderDir:this.orderDir,size:this.size};e.addAggregation(es.newTermsAggregation(t)),es.doQuery({search_url:this.edge.search_url,queryobj:e.objectify(),datatype:this.edge.datatype,success:edges.objClosure(this,"doUpdateQuerySuccess",["result"]),error:edges.objClosure(this,"doUpdateQueryFail")})}},this.doUpdateQuerySuccess=function(e){for(var t=e.result,i=t.buckets(this.id),s=0;s<this.terms.length;s++){for(var r=this.terms[s],n=!1,o=0;o<i.length;o++){var h=i[o];if(r.term===h.key){r.count=h.doc_count,n=!0;break}}n||(r.count=0)}this.updating=!1,this.draw()},this.doUpdateQueryFail=function(){},this.selectTerm=function(e){var t=this.edge.cloneQuery(),i=t.listMust(es.newTermsFilter({field:this.field}));if(i.length>0){var s=i[0];s.add_term(e)}else t.addMust(es.newTermsFilter({field:this.field,values:[e]}));t.from=0,this.edge.pushQuery(t),this.edge.doQuery()},this.removeFilter=function(e){var t=this.edge.cloneQuery(),i=t.listMust(es.newTermsFilter({field:this.field}));if(i.length>0){var s=i[0];s.has_term(e)&&s.remove_term(e),s.has_terms()||t.removeMust(es.newTermsFilter({field:this.field}))}t.from=0,this.edge.pushQuery(t),this.edge.doQuery()},this._translate=function(e){if(this.valueMap){if(e in this.valueMap)return this.valueMap[e]}else if(this.valueFunction)return this.valueFunction(e);return e}},newBasicRangeSelector:function(e){return e||(e={}),edges.BasicRangeSelector.prototype=edges.newSelector(e),new edges.BasicRangeSelector(e)},BasicRangeSelector:function(e){this.ranges=e.ranges||[],this.formatUnknown=e.formatUnknown||!1,this.defaultRenderer=e.defaultRenderer||"newBasicRangeSelectorRenderer",this.values=[],this.filters=[],this.contrib=function(e){for(var t=[],i=0;i<this.ranges.length;i++){var s=this.ranges[i],r={};s.from&&(r.from=s.from),s.to&&(r.to=s.to),t.push(r)}e.addAggregation(es.newRangeAggregation({name:this.id,field:this.field,ranges:t}))},this.synchronise=function(){if(this.values=[],this.filters=[],this.edge.result)for(var e=this.edge.result.buckets(this.id),t=0;t<this.ranges.length;t++){var i=this.ranges[t],s=this._getRangeBucket(e,i.from,i.to),r=$.extend(!0,{},i);r.count=s.doc_count,this.values.push(r)}if(this.edge.currentQuery)for(var n=this.edge.currentQuery.listMust(es.newRangeFilter({field:this.field})),t=0;t<n.length;t++){var o=n[t].lt,h=n[t].gte,i=this._getRangeDef(h,o);i?this.filters.push(i):this.filters.push({display:this._formatUnknown(h,o),from:h,to:o})}},this.selectRange=function(e,t){var i=this.edge.cloneQuery(),s={field:this.field};e&&(s.gte=e),t&&(s.lt=t),i.addMust(es.newRangeFilter(s)),i.from=0,this.edge.pushQuery(i),this.edge.doQuery()},this.removeFilter=function(e,t){var i=this.edge.cloneQuery(),s={field:this.field};e&&(s.gte=e),t&&(s.lt=t),i.removeMust(es.newRangeFilter(s)),i.from=0,this.edge.pushQuery(i),this.edge.doQuery()},this._getRangeDef=function(e,t){for(var i=0;i<this.ranges.length;i++){var s=this.ranges[i],r=!0,n=!0;if((e&&!s.from||!e&&s.from)&&(r=!1),(t&&!s.to||!t&&s.to)&&(n=!1),e&&s.from&&e!==s.from&&(r=!1),t&&s.to&&t!==s.to&&(n=!1),r&&n)return s}return!1},this._getRangeBucket=function(e,t,i){for(var s=0;s<e.length;s++){var r=e[s],n=!0,o=!0;if((t&&!r.from||!t&&r.from)&&(n=!1),(i&&!r.to||!i&&r.to)&&(o=!1),t&&r.from&&t!==r.from&&(n=!1),i&&r.to&&i!==r.to&&(o=!1),n&&o)return r}return!1},this._formatUnknown=function(e,t){if(this.formatUnknown)return this.formatUnknown(e,t);var i="";return i+=e?e:"< ",t?i+=e?" - "+t:t:e?i+="+":i="unknown",i}},newBasicGeoDistanceRangeSelector:function(e){return e||(e={}),edges.BasicGeoDistanceRangeSelector.prototype=edges.newSelector(e),new edges.BasicGeoDistanceRangeSelector(e)},BasicGeoDistanceRangeSelector:function(e){this.distances=e.distances||[],this.hideEmptyDistance=e.hideEmptyDistance||!0,this.unit=e.unit||"m",this.lat=e.lat||!1,this.lon=e.lon||!1,this.values=[],this.synchronise=function(){this.values=[]}},newDateHistogramSelector:function(e){return e||(e={}),edges.BasicRangeSelector.prototype=edges.newSelector(e),new edges.BasicRangeSelector(e)},DateHistogramSelector:function(e){this.interval=e.interval||"year",this.sort=e.sort||"asc",this.hideEmptyDateBin=e.hideEmptyDateBin||!0,this.shortDisplay=e.shortDisplay||!1,this.values=[],this.synchronise=function(){this.values=[]}},newAutocompleteTermSelector:function(e){return e||(e={}),edges.AutocompleteTermSelector.prototype=edges.newComponent(e),new edges.AutocompleteTermSelector(e)},AutocompleteTermSelector:function(e){this.defaultRenderer=e.defaultRenderer||"newAutocompleteTermSelectorRenderer"}});