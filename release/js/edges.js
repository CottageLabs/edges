var edges={newEdge:function(e){return e||(e={}),new edges.Edge(e)},Edge:function(e){this.selector=e.selector||"body",this.search_url=e.search_url,this.datatype=e.datatype||"jsonp",this.baseQuery=e.baseQuery||!1,this.openingQuery=e.openingQuery||es.newQuery(),this.initialSearch=e.initialSearch||!0,this.manageUrl=e.manageUrl||!1,this.urlQuerySource=e.urlQuerySource||"source",this.template=e.template||!1,this.components=e.components||[],this.renderPacks=e.renderPacks||[edges.bs3,edges.nvd3,edges.highcharts,edges.google,edges.d3],this.urlQuery=!1,this.urlParams={},this.shortUrl=!1,this.currentQuery=!1,this.result=!1,this.searching=!1,this.context=!1,this.startup=function(){if(this.context=$(this.selector),this.context.trigger("edges:pre-init"),this.manageUrl){var e=this.getUrlParams();this.urlQuerySource in e&&(this.urlQuery=es.newQuery({raw:e[this.urlQuerySource]}),delete e[this.urlQuerySource]),this.urlParams=e}this.template&&this.template.draw(this);for(var t=0;t<this.components.length;t++){var r=this.components[t];r.init(this)}for(var t=0;t<this.components.length;t++){var r=this.components[t];r.draw(this)}var n=this.openingQuery;this.urlQuery&&(n=this.urlQuery,this.urlQuery=!1);for(var t=0;t<this.components.length;t++){var r=this.components[t];r.contrib(n)}this.pushQuery(n),this.context.trigger("edges:post-init"),this.doQuery()},this.synchronise=function(){for(var e=0;e<this.components.length;e++){var t=this.components[e];t.synchronise()}},this.reset=function(){this.context.trigger("edges:pre-reset");for(var e=this.cloneOpeningQuery(),t=0;t<this.components.length;t++){var r=this.components[t];r.contrib(e)}this.pushQuery(e),this.context.trigger("edges:post-reset"),this.doQuery()},this.cloneQuery=function(){return $.extend(!0,{},this.currentQuery)},this.pushQuery=function(e){this.baseQuery&&e.merge(this.baseQuery),this.currentQuery=e},this.cloneBaseQuery=function(){return this.baseQuery?$.extend(!0,{},this.baseQuery):es.newQuery()},this.cloneOpeningQuery=function(){return this.openingQuery?$.extend(!0,{},this.openingQuery):es.newQuery()},this.doQuery=function(){this.searching||(this.searching=!0,this.shortUrl=!1,this.context.trigger("edges:pre-query"),this.manageUrl&&this.updateUrl(),es.doQuery({search_url:this.search_url,queryobj:this.currentQuery.objectify(),datatype:this.datatype,success:edges.objClosure(this,"querySuccess",["result"]),error:edges.objClosure(this,"queryFail"),complete:edges.objClosure(this,"queryComplete")}))},this.queryFail=function(e){this.context.trigger("edges:query-fail")},this.querySuccess=function(e){this.result=e.result,this.context.trigger("edges:query-success"),this.synchronise()},this.queryComplete=function(){this.context.trigger("edges:pre-render");for(var e=0;e<this.components.length;e++){var t=this.components[e];t.draw()}this.context.trigger("edges:post-render"),this.searching=!1},this.category=function(e){for(var t=[],r=0;r<this.components.length;r++){var n=this.components[r];n.category===e&&t.push(n)}return t},this.getRenderPackObject=function(e,t){for(var r=0;r<this.renderPacks.length;r++){var n=this.renderPacks[r];if(n&&n.hasOwnProperty(e))return n[e](t)}},this.jq=function(e){return $(e,this.context)},this.getUrlParams=function(){var e={},t=window.location.href,r=!1;t.indexOf("#")>-1&&(r=t.slice(t.indexOf("#")),t=t.substring(0,t.indexOf("#")));for(var n=t.slice(t.indexOf("?")+1).split("&"),s=0;s<n.length;s++){var i=n[s].split("=");if(2===i.length){var o=decodeURIComponent(i[1]);("["==o[0]||"{"==o[0])&&(o=o.replace(/^"/,"").replace(/"$/,""),o=JSON.parse(o)),e[i[0]]=o}}return r&&(e["#"]=r),e},this.urlQueryArg=function(e){e||(e={include_query_string:!0,include_filters:!0,include_paging:!0,include_sort:!0,include_fields:!1,include_aggregations:!1,include_facets:!1});var t=JSON.stringify(this.currentQuery.objectify(e)),r={};return r[this.urlQuerySource]=encodeURIComponent(t),r},this.fullQueryArgs=function(){var e=$.extend(!0,{},this.urlParams);return $.extend(e,this.urlQueryArg()),e},this.fullUrlQueryString=function(){return this._makeUrlQuery(this.fullQueryArgs())},this._makeUrlQuery=function(e){for(var t=Object.keys(e),r=[],n=0;n<t.length;n++){var s=t[n],i=e[s];r.push(s+"="+i)}return r.join("&")},this.fullUrl=function(){var e=this.fullQueryArgs(),t="";e["#"]&&(t="#"+e["#"],delete e["#"]);var r=window.location.toString(),n=r.split("?"),s=n[0]+"?"+this._makeUrlQuery(e)+t;return s},this.updateUrl=function(){if("pushState"in window.history){var e="?"+this.fullUrlQueryString();window.history.pushState("","",e)}},this.startup()},newRenderer:function(e){return e||(e={}),new edges.Renderer(e)},Renderer:function(e){this.component=e.component||!1,this.init=function(e){this.component=e},this.draw=function(e){}},newComponent:function(e){return e||(e={}),new edges.Component(e)},Component:function(e){this.id=e.id,this.renderer=e.renderer,this.category=e.category||"none",this.defaultRenderer=e.defaultRenderer||"newRenderer",this.init=function(e){this.edge=e,this.context=this.edge.jq("#"+this.id),this.renderer||(this.renderer=this.edge.getRenderPackObject(this.defaultRenderer)),this.renderer&&this.renderer.init(this)},this.draw=function(){this.renderer&&this.renderer.draw()},this.contrib=function(e){},this.synchronise=function(){},this.jq=function(e){return this.edge.jq(e)}},newSelector:function(e){return e||(e={}),edges.Selector.prototype=edges.newComponent(e),new edges.Selector(e)},Selector:function(e){this.field=e.field,this.display=e.display||this.field,this.active=e.active||!0,this.disabled=e.disabled||!1,this.category=e.category||"selector"},newTemplate:function(e){return e||(e={}),new edges.Template(e)},Template:function(e){this.draw=function(e){}},objClosure:function(e,t,r){return function(){if(r){for(var n={},s=0;s<r.length;s++)arguments.length>s&&(n[r[s]]=arguments[s]);e[t](n)}else{var i=Array.prototype.slice;e[t].apply(e,i.apply(arguments))}}},eventClosure:function(e,t,r){return function(n){(!r||r(n))&&(n.preventDefault(),e[t](this))}},css_classes:function(e,t,r){var n=e+"-"+t;return r&&(n+=" "+n+"-"+r.component.id),n},css_class_selector:function(e,t,r){var n="."+e+"-"+t;return r&&(n+=n+"-"+r.component.id),n},css_id:function(e,t,r){var n=e+"-"+t;return r&&(n+="-"+r.component.id),n},css_id_selector:function(e,t,r){return"#"+edges.css_id(e,t,r)},on:function(e,t,r,n,s,i){t=t+"."+r.component.id;var o=edges.eventClosure(r,n,i);s?r.component.jq(e).bindWithDelay(t,o,s):r.component.jq(e).on(t,o)},escapeHtml:function(e){return"function"!=typeof e.replace?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},objVal:function(e,t,r){void 0===r&&(r=!1);for(var n=e.split("."),s=t,i=0;i<n.length;i++){var o=n[i];if(!(o in s))return r;s=s[o]}return s},getParam:function(e,t){return void 0!==e?e:t}};